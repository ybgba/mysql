CREATE PROCEDURE `create_partition_by_day`(IN_SCHEMANAME VARCHAR(64), IN_TABLENAME VARCHAR(64))
BEGIN
    
    DECLARE ROWS_CNT INT UNSIGNED;
    
    DECLARE TARGET_DATE TIMESTAMP;
    DECLARE TARGET_DATE_NEXT TIMESTAMP;
    
    DECLARE PARTITIONNAME VARCHAR(9);
    
    DECLARE PARTITION_ADD_DAY VARCHAR(10);
    SET TARGET_DATE = NOW() + INTERVAL 3 DAY;
    SET PARTITIONNAME = DATE_FORMAT( TARGET_DATE, 'P%Y%m%d' );
    SET TARGET_DATE_NEXT = TARGET_DATE + INTERVAL 1 DAY;
    SET PARTITION_ADD_DAY = UNIX_TIMESTAMP(CONCAT(DATE_FORMAT( TARGET_DATE_NEXT, '%Y-%m-%d' ),' 00:00:00'));
    SELECT COUNT(*) INTO ROWS_CNT FROM information_schema.partitions
    WHERE table_schema = IN_SCHEMANAME AND table_name = IN_TABLENAME AND partition_name = PARTITIONNAME;
    IF ROWS_CNT = 0 THEN
        SET @SQL = CONCAT( 'ALTER TABLE `', IN_SCHEMANAME, '`.`', IN_TABLENAME, '`',
        ' ADD PARTITION (PARTITION ', PARTITIONNAME, " VALUES LESS THAN (",
            PARTITION_ADD_DAY ,") ENGINE = InnoDB);" );
        PREPARE STMT FROM @SQL;
        EXECUTE STMT;
        DEALLOCATE PREPARE STMT;
     ELSE
       SELECT CONCAT("partition `", PARTITIONNAME, "` for table `",IN_SCHEMANAME, ".", IN_TABLENAME, "` already exists") AS result;
     END IF;
END
