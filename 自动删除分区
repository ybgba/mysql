CREATE PROCEDURE `drop_partition_by_day`(IN_SCHEMANAME VARCHAR(64), IN_TABLENAME VARCHAR(64))
BEGIN
    
    DECLARE ROWS_CNT INT UNSIGNED;
    
    DECLARE TARGET_DATE TIMESTAMP;
    DECLARE TARGET_DATE_NEXT TIMESTAMP;
    
    DECLARE PARTITIONNAME VARCHAR(9);
    
    SET TARGET_DATE = NOW() + INTERVAL -3 DAY;
    SET PARTITIONNAME = DATE_FORMAT( TARGET_DATE, 'P%Y%m%d' );
    SELECT COUNT(*) INTO ROWS_CNT FROM information_schema.partitions
    WHERE table_schema = IN_SCHEMANAME AND table_name = IN_TABLENAME AND partition_name = PARTITIONNAME;
    IF ROWS_CNT = 1 THEN
        SET @SQL = CONCAT( 'ALTER TABLE `', IN_SCHEMANAME, '`.`', IN_TABLENAME, '`',
        ' DROP PARTITION ', PARTITIONNAME, " ;" );
        PREPARE STMT FROM @SQL;
        EXECUTE STMT;
        DEALLOCATE PREPARE STMT;
     ELSE
       SELECT CONCAT("partition `", PARTITIONNAME, "` for table `",IN_SCHEMANAME, ".", IN_TABLENAME, "` not exists") AS result;
     END IF;
END
